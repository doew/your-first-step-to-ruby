---
marp: true
---
<!--
headingDivider: 3
-->

# 3 基礎プログラミング実践 後半

## この章では・・・
この章では、条件分岐を用いたり、クラスの定義、配列、標準ライブラリの活用などをおこなっていく。前半よりも発展的なプログラムを書いていく。

## 条件分岐
賢いプログラムを書こうと思う時、条件分岐をしたくなる時がある。条件分岐では、論理式を評価して、その結果によって文を実行するしないを判断することができる。

#### 要件
1. `ok` という変数に `gets` メソッドの返り値を代入すること
1. `ok` を評価して、 `true` と等価なときには `OK` と表示すること
1. 前項に当てはまらないとき、 `Canceled` と表示すること

### サンプルコード
```rb
ok = gets
if ok then
  puts "OK"
else
  puts "Canceled"
end
```
tips: Ruby では、メソッドコール（関数呼び出し）するときに、引数指定用の丸括弧を省略できる。ただし、メソッドチェーンするときは使えない。

### plus alpha
論理式がどのように評価されるのかみてみよう。
ex. を１行ずつそれぞれ実行して結果を確認してみてほしい。

ex. 
```rb
puts "true" if true
puts "true" if ""
puts "true" if 0
```

tips: ruby では `false` と等価なのは、 `nil` と `0` そして、 `false` 自身のみである。
tips: ruby では、後置if という `if`のキーワードと論理式を true の時に実行する式の後に置くことができる。また、 `then` のキーワードは省略できる。

## クラス
Ruby はオブジェクト指向プログラミングのため、オブジェクトのクラスを定義することができる。クラスは、インスタンスというオブジェクトを生むことができる。
いわば、クラスはオブジェクトのための版（ハンコ）であり、インスタンスは版で刷った紙（ハンコを押した跡、印影）のような関係である。

#### インスタンスは属性(attributes)をそれぞれ持つことができる
クラスに定義された属性の初期値によらず、インスタンスはそれぞれの属性を持つことができる。

#### 要件
`name`属性を持ち、`make_sound`インスタンスメソッドにより`meow` と表示するインスタンスを生成するクラス `Cat` を定義すること。

### サンプルコード
```rb
class Cat
  attr_accessor: :name
  def make_sound
    puts "meow"
  end
end
```

tips: クラス名はアッパーキャメルケース(パスカルケース)で記述することが一般的。言語仕様では、初めの一文字目が大文字でなければならないことになっている。
tips: メソッド名はスネークケースを用いることが一般的。

### plus alpha
前項の `Cat` クラスのインスタンス `cat` を生成し、 `name` 属性に `tama` と設定してみよう。
また、 `tama` インスタンスオブジェクトに `make_sound` メソッドコールをしてみよう。

tips: インスタンスオブジェクトは クラスに対して`new`をメソッドコールすると返り値として生成される。 

### plus alpha - サンプルコード
```rb
class Cat
  # 中身は省略
end

cat = Cat.new
cat.name = 'tama'
cat.name
# try ruby 環境の人はここまでで一旦実行してみてほしい
# => 'tama'
cat.make_sound
# 'meow'
``` 

## 配列
配列やハッシュは、一つの変数の中に複数の値を埋め込むことができる型である。Rubyでは、型は単純に型クラスのインスタンスでしかないから、 配列を例に挙げると`Array.new` をした返り値を変数に代入することで、宣言を再現できる。

初期化を伴う場合は、`[value, value, ... value]` を代入するだけでもArrayクラスのインスタンスを持つ変数を表現できる。

#### 要件
1. 変数 `a` に `[1,2,3 ... 10]` のような 1~10 の整数を要素に持つ配列を代入すること。
1. `a[0]` を呼び出して値を表示すること。
1. `a[2]` を呼び出して値を表示すること。

### サンプルコード
```rb
a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] # a = 1..10.to_a でも可
puts a[0]
# 1
puts a[2]
# 3
```
tips: ruby では配列のインデックス（索引）は0 から始まる。
tips: Array の他にも独自の記法でクラスのインスタンスを表現することができるものがあり、 `1..10` は `Range` クラスのインスタンスを表現できる。

### plus alpha
1から100までの整数を持つ配列を作成してみよう。

tips: 全部列挙するのは現実的でないので、 `Range` クラスのインスタンスを用いよう。

## 標準ライブラリ net/http
```
注意：ここからは Try Ruby 環境では動作が難しいので、irbを利用しよう。
```

さて、ついにライブラリを活用していこう。まずは`net/http` から。このライブラリはHTTPの通信を簡単に扱うためのクラスが詰まっている。

#### 要件
1. http://example.com/ へGET HTTP METHOD でリクエストを送り、レスポンスのBODYを表示すること。

### サンプルコード
```rb
# 標準ライブラリを読み込む
require 'net/http'

# ここではNet::HTTPのクラスメソッド（特異メソッド）を利用した
print Net::HTTP.get('example.com', '/')
```
実行後、レスポンスボディ(`<!doctype html>~~~~`)が表示されればok.

tips: 特異メソッド(Singleton Method)は、ある特定のオブジェクトのみで利用できるメソッドのこと。クラスメソッドは、クラス(ここでいう `Net::HTTP`)に対して呼ばれるメソッドで、今回は`get`メソッドがそれにあたる。 `get`メソッドは、クラスメソッドであり、特異メソッドでもある。

### plus alpha
http://httpbin.org/ip に get リクエストを送り、そのレスポンスボディを表示してみよう。

### plus alpha サンプルコード
```rb
require 'net/http'

Net::HTTP.get_print('httpbin.org', '/ip')
```
#### 出力
```rb
irb(main):008:0> Net::HTTP.get_print('httpbin.org', '/ip')
{
  "origin": "118.156.252.207"
}
=> nil
```

## 総合演習
さて、ここまでの復習がてら総合演習を一つやってみよう。次の要件を満たすプログラムを書くこと。リファレンスやインターネット検索は自由に用いて調べてよい。

#### スクリプトを書く
手元のエディターで、これまでに try ruby や irbで書いてきたコードを書いたファイルを保存してみよう。保存したスクリプトは、`ruby [スクリプトファイル]` で、実行することができる。

### 要件
1. 標準出力に「名前を入力してください」と表示し、その直後に改行すること。
1. 標準入力から入力を待受け、入力された名前を変数に格納すること。
1. もし、何も入力されずに標準入力が帰ってきた場合、「さようなら」と表示し、プログラムを終了すること。
1. `https://doew.github.io/your-first-step-to-ruby/3/hello` の内容をHTTP GET METHODで取得し、変数に格納すること。
1. 標準出力に 「{name}さん、{geted_content}」と表示すること。{}はそれぞれ変数が正しく展開されること。

### サンプルコード
```rb
#!/bin/ruby
require 'net/http'

puts '名前を入力してください'
name = gets

exit if name == '' || name.nil?

content = Net::HTTP.get(URI.parse 'https://doew.github.io/your-first-step-to-ruby/3/hello')
puts "#{name}さん、#{content}"
```

tips: shebang は書かなくても良い。shebang を書かない場合は `.rb` で保存するなど、rubyで記述したことが分かる様にしておく。
tips: `Net::HTTP.get` は、1引数のとき、 `URI` クラスのオブジェクトを期待する。

動作が要件を満たしていれば、サンプルコードと全く同じでなくても構わない。

## まとめ
この章では、より複雑なRubyプログラムを書けるようになったはず。標準ライブラリを使いこなすことで、様々なプログラムを実現出来る。

## 4章の予告
4章では、Appendixと拡張(外部)ライブラリを用いる。
